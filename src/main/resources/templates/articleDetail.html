<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" th:href="@{/bootstrap.min.css}">
</head>
<body>
<h2>게시물</h2>
        <div>
            <input type="text" th:value="${article.title}">
            <input type="text" th:value="${article.content}">
            <input type="text" th:value="${article.createDate}">
        </div>
<h2>댓글</h2>
       <ul>
           <li th:each="comment : ${article.commentList}">
               <div>
                   <span th:text="${comment.content}"></span><br>
                   <span th:text="${#temporals.format(comment.createDate, 'yyyy-MM-dd HH:mm:ss')}"></span><br>
               </div>
               <a th:data-uri="@{|/Comment/delete/${comment.id}?articleId=${article.id}|}" class="delete btn btn-sm btn-outline-secondary"
                  sec:authorize="isAuthenticated()" th:if="${comment.member != null and #authentication.getPrincipal().getUsername() == comment.member.loginId}"
                  th:text="삭제">
               </a>
              <div th:if="${comment.member != null and #authentication.getPrincipal().getUsername() == comment.member.loginId}" sec:authorize="isAuthenticated()">
               <input type="button" value="수정" th:onclick="toggleDivVisibility([[${comment.id}]])" th:id="'commentButton-' + ${comment.id}">
              </div>
               <form th:action="@{|/Comment/modify/${comment.id}|}" method="get">
               <div th:id="'contentDiv-'+ ${comment.id}" style="display: none;">
                   <input type="hidden" name="articleId" th:value="${article.id}">
                   <textarea class="form-control" id="floatingTextarea" style="height: 100px" name="newcontent" th:text="${content}"></textarea>
                   <input type="submit" value="댓글 수정하기">
                   <input type="button" value="취소" th:onclick="hideDiv([[${comment.id}]])" th:id="'cancelButton-' + ${comment.id}">
               </div>
               </form>
           </li>
       </ul>
        <form th:action="@{|/Comment/create/${id}|}" th:object="${commentcreateForm}" method="get">
        <div class="form-floating">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <input type="hidden" th:value="${article.id}" name="id">
            <textarea class="form-control" placeholder="댓글을 남겨보세요." id="floatingTextarea2" style="height: 100px" name="content" th:value="${content}"></textarea>
            <input type="submit" value="댓글 작성하기">
        </div>
        </form>
<script th:inline="javascript">
    var currentlyVisibleDivId = null;

    function toggleDivVisibility(commentId) {
        var contentDiv = document.getElementById("contentDiv-" + commentId);
        var commentButton = document.getElementById("commentButton-" + commentId);
        var cancelButton = document.getElementById("cancelButton-" + commentId);

        if (currentlyVisibleDivId !== null) {
            hideDiv(currentlyVisibleDivId);
        }

        if (contentDiv.style.display === "none") {
            contentDiv.style.display = "block";
            commentButton.style.display = "none";
            currentlyVisibleDivId = commentId;
        } else {
            contentDiv.style.display = "none";
            commentButton.style.display = "block";
            currentlyVisibleDivId = null;
        }
    }

    function hideDiv(commentId) {
        var contentDiv = document.getElementById("contentDiv-" + commentId);
        var commentButton = document.getElementById("commentButton-" + commentId);

        contentDiv.style.display = "none";
        commentButton.style.display = "block";
    }
</script>
<script type='text/javascript'>
    const delete_elements = document.getElementsByClassName("delete");
    Array.from(delete_elements).forEach(function(element) {
        element.addEventListener('click', function() {
            if(confirm("정말로 삭제하시겠습니까?")) {
                location.href = this.dataset.uri;
            };
        });
    });
</script>
</body>
</html>