<!DOCTYPE html>
<html layout:decorate="~{layout}" xmlns:layout="http://www.w3.org/1999/xhtml" xmlns:th="" style="width:1920px">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/movie/mainlist.css">
</head>
<body>
<div layout:fragment="content">
    <section class="list_cont">
        <div class="suggestion_cont">
            <h1><strong>추천 5</strong></h1>
            <div class="img-container">
                <div class="box">
                    <img src="https://i.namu.wiki/i/dQYtrYCT20iBXl8NVB32m-USGBNORan-hsEgwrGpEQeivNd-R-MTfLh0v01lmGV3CUc4PMCuW6BEswVt_Gt6MQ.webp"
                         alt=""/>
                </div>
                <div class="box">
                    <img src="https://i.namu.wiki/i/Jw0sUVobNhQaqLSOE1C7iSozBgLh6rRIv-MK-rQKDRIpZwEhZVtSnMTN1c_0FSEkVTksvl4y9rLBGDPJTMbaNg.webp"
                         alt=""/>
                </div>
                <div class="box">
                    <img src="https://i.namu.wiki/i/4B9xgGFK3QKCN4KILuNYhXNFQdTrewvumd-77wLBZ39Gqw1KO_w6uL0y9vM280U41p0zRBsfFMFVE30w85Q1bA.webp"
                         alt=""/>
                </div>
                <div class="box">
                    <img src="https://i.namu.wiki/i/hH9glgx5SvCd85X2KvGOwJ9zl0bdorVUwLw4S2lprbItV2qYiphUC84bcks5HY3YcnitO4oQWwZxVAGucmJHIw.webp"
                         alt=""/>
                </div>
                <div class="box">
                    <img src="https://i.namu.wiki/i/c1IIhmP363GHY4vtClQViy6dqGlA42G36LUBNs_C6l0GZXImLBtzVzAJGuebxlbxUzU8hCNKzrjkVzJB_RxMAg.webp"
                         alt=""/>
                </div>
            </div>
        </div>
    </section>


    <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="genreDropdownButton" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
            장르
        </button>
        <ul class="dropdown-menu" id="genreDropdown">
            <a href="/movie/top100">
                <li>전체</li>
            </a>
            <li th:each="genre : ${genres}">
                <a th:href="@{|/movie/top100?genreId=${genre.id}|}" th:text="${genre.genreNm}"
                   onclick="selectGenre(this)"></a>
            </li>

        </ul>
    </div>
    <section class="list_box_wrap" id="listContainer">
        <section class="list_box">
            <div class="list genre" th:each="movie : ${movieList}">
                <div class="list_item">
                    <div class="list_item" th:style="'background-image: url(' + ${movie.posters } + ');'">
                        <div class="additional-info">
                            <div style="padding-top: 10px; text-align: center;font-weight: bold;font-size: 25px;"
                                 th:text="${movie.movieNm}"></div>
                            <div class="sub_info">
                                <p style="margin: 5px 0 0 0;">개봉일 : <span th:text="${#strings.replace(#strings.replace(#strings.substring(movie.openDt, 0, 4) + '-' + #strings.substring(movie.openDt, 4, 6) + '-' + #strings.substring(movie.openDt, 6, 8), '-', ' '), ' ', '-')}"></span></p>
                                <div style="margin-top: 10px;text-align: center;">
                                    <a th:href="@{|/movie/detail/${movie.id}|}">상세보기</a>
                                </div>
                                <a href="javascript:void(0);" class="recommend btn btn-sm btn-outline-secondary"
                                   th:data-uri="@{|/movie/vote/${movie.id}|}" onclick="voteMovie(${movie.id})"  style=" width: 98%;">
                                    찜하기
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </section>
    <script>
        $(document).ready(function() {
         // 페이지 로드 시 localStorage에 저장된 genre 정보를 확인
         var storedGenre = localStorage.getItem('selectedGenre');

         // 저장된 정보가 있으면 해당 정보를 버튼에 적용
         if (storedGenre) {
           storedGenre = JSON.parse(storedGenre);
           $('#genreDropdownButton').html(storedGenre.name);
         } else {
           // 만약 저장된 정보가 없다면, 초기값을 설정
           var defaultGenre = 'Default Genre'; // 원하는 초기값으로 변경
           $('#genreDropdownButton').html(defaultGenre);

           // 초기값을 localStorage에 저장
           localStorage.setItem('selectedGenre', JSON.stringify({ id: 0, name: defaultGenre }));
         }

         // Dropdown에서 항목을 클릭했을 때 이벤트 처리
         $('#genreDropdown a').on('click', function(){
           var selectedGenre = $(this).text(); // 선택한 장르 텍스트
           var selectedGenreId = $(this).data('genre-id'); // 선택한 장르 ID

           // 선택한 장르 정보를 버튼에 적용
           $('#genreDropdownButton').html(selectedGenre);

           // 선택한 장르 정보를 localStorage에 저장
           localStorage.setItem('selectedGenre', JSON.stringify({ id: selectedGenreId, name: selectedGenre }));
         });
       });
    </script>
    <script>
        let currentSlide = 0;
        const totalSlides = document.querySelectorAll('.list_box').length;
        const listContainer = document.getElementById('listContainer');
        const moveDistance = -1925; // 이동 거리

        function movePage(direction) {
            currentSlide += direction;

            // 처음 또는 마지막 슬라이드에 도달하면 반대편으로 이동
            if (currentSlide < 0) {
                currentSlide = totalSlides - 1;
            } else if (currentSlide >= totalSlides) {
                currentSlide = 0;
            }
            const translateValue = currentSlide * moveDistance;
            listContainer.style.transform = `translateX(${translateValue}px)`;
        }
    <script>
        window.addEventListener("keydown", function(e) {
        // space and arrow keys
        if([32, 37, 38, 39, 40].indexOf(e.keyCode) > -1) {
            e.preventDefault();
        }
    }, false);
    </script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        const recommendElements = document.getElementsByClassName('recommend');
        Array.from(recommendElements).forEach(function(element) {
            element.addEventListener('click', function() {
                if (confirm('이 영화를 찜하시겠습니까?')) {
                    // 추가된 부분: AJAX를 이용한 로그인 상태 확인
                    $.ajax({
                        url: "/check-login-status",
                        method: "GET",
                        success: function(response) {
                            if (response.loggedIn) {
                                // 로그인된 경우 리뷰 작성 페이지로 이동
                                location.href = element.dataset.uri;
                            } else {
                                // 로그인되지 않은 경우 알림 메시지 표시
                                alert("로그인이 필요합니다.");
                                // 로그인 페이지로 리다이렉트
                                window.location.href = "/member/login";
                            }
                        }
                    });
                }
            });
        });
    </script>
    <script>
        let imgContainer = document.querySelector(".img-container");

    setInterval(() => {
    let last = imgContainer.firstElementChild;
    last.remove();
    imgContainer.appendChild(last);
    }, 2500);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
            crossorigin="anonymous"></script>

</div>
</body>
</html>