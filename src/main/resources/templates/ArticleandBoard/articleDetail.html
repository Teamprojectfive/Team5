<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" th:href="@{/bootstrap.min.css}">
</head>
<body>
<h2>ê²Œì‹œë¬¼</h2>
<div>
    <input type="text" th:value="${article.title}" readonly>
    <input type="text" th:value="${article.content}" readonly>
    <input type="text" th:value="${#temporals.format(article.createDate, 'yyyy-MM-dd HH:mm:ss')}" readonly>
</div>
<h2>ëŒ“ê¸€</h2>
<ul>
    <li th:each="comment : ${article.commentList}">
        <div>
            <span th:text="${comment.member.nickName}">
            </span><br>
            <span th:text="${comment.content}"></span><br>
            <span th:text="${#temporals.format(comment.createDate, 'yyyy-MM-dd HH:mm:ss')}"></span><br>
            <a href="javascript:void(0);" class="recommend btn btn-sm btn-outline-secondary"
               th:data-uri="@{|/Comment/vote/${comment.id}|}"
               th:data-recommended="${ActionCheck}"
               th:onclick="voteComment([[${comment.id}]])">
                &#x1F44D; <!-- ë”°ë´‰ ì•„ì´ì½˜(ğŸ‘)ì˜ Unicode ì½”ë“œ í¬ì¸íŠ¸ -->
                <span class="badge rounded-pill bg-success" th:text="${#lists.size(comment.voter)}"></span>
            </a>
            <a th:data-uri="@{|/Comment/delete/${comment.id}?articleId=${article.id}|}"
               class="delete btn btn-sm btn-outline-secondary"
               sec:authorize="isAuthenticated()"
               th:if="${comment.member != null and #authentication.getPrincipal().getUsername() == comment.member.loginId}"
               th:text="ì‚­ì œ">
            </a>
            <div th:if="${comment.member != null and #authentication.getPrincipal().getUsername() == comment.member.loginId}"
                 sec:authorize="isAuthenticated()">
                <input type="button" value="ìˆ˜ì •" th:onclick="toggleDivVisibility([[${comment.id}]])"
                       th:id="'commentButton-' + ${comment.id}" class="commentModifyClass">
            </div>
            <form th:action="@{|/Comment/modify/${comment.id}|}" method="get">
                <div th:id="'contentDiv-'+ ${comment.id}" style="display: none;" class="allComment">
                    <input type="hidden" name="articleId" th:value="${article.id}">
                    <textarea class="form-control" id="floatingTextarea" style="height: 100px" name="newcontent"
                              th:text="${content}"></textarea>
                    <input type="submit" value="ëŒ“ê¸€ ìˆ˜ì •í•˜ê¸°">
                    <input type="button" value="ì·¨ì†Œ" th:onclick="hideDiv([[${comment.id}]])"
                           th:id="'cancelButton-' + ${comment.id}">
                </div>
            </form>
            <ul>
                <li th:each="reply : ${comment.commentReplyList}">
                    <label for="text">ì—¬ê¸° ìœ„ì—ê°€ ëŒ“ê¸€ ë°‘ì— ë²„íŠ¼ì€ ë‹µê¸€ì˜ ìˆ˜ì •ì‚­ì œë²„íŠ¼</label>
                    <span th:text="${reply.member.nickName}"></span>
                    <span th:text="${reply.content}"></span>
                    <span th:text="${#temporals.format(reply.createDate, 'yyyy-MM-dd HH:mm:ss')}"></span>
                    <a href="javascript:void(0);" class="recommend btn btn-sm btn-outline-secondary"
                       th:data-uri="@{|/reply/vote/${reply.id}|}"
                       th:data-recommended="${ActionCheck}"th:onclick="voteReply([[${reply.id}]])">
                        ì¢‹ì•„ìš”
                        <span class="badge rounded-pill bg-success" th:text="${#lists.size(reply.voter)}"></span>
                    </a>
                    <a th:data-uri="@{|/reply/delete/${reply.id}?articleId=${article.id}|}"
                       class="delete btn btn-sm btn-outline-secondary"
                       sec:authorize="isAuthenticated()"
                       th:if="${reply.member != null and #authentication.getPrincipal().getUsername() == reply.member.loginId}"
                       th:text="ì‚­ì œ">
                    </a>
                    <!--ë‹µê¸€ ìˆ˜ì •  ì‹œì‘ !!-->
                    <div th:if="${reply.member != null and #authentication.getPrincipal().getUsername() == reply.member.loginId}"
                         sec:authorize="isAuthenticated()">
                        <input type="button" value="ìˆ˜ì •" th:onclick="toggleReplyDivVisibility([[${reply.id}]])"
                               th:id="'replyModifyButton-' + ${reply.id}" class="replyModifyClass">
                    </div>
                    <form th:action="@{|/reply/modify/${reply.id}|}" th:object="${commentReplyForm}" method="get">
                        <div th:id="'replyModifyForm-' + ${reply.id}" style="display: none;" class="allReplyModifyForm">
                            <input type="hidden" name="articleId" th:value="${article.id}">
                            <textarea class="form-control" id="floatingTextarea5" style="height: 100px" name="content"
                                      th:text="${reply.content}"></textarea>
                            <input type="submit" value="ë‹µê¸€ ìˆ˜ì •í•˜ê¸°">
                            <input type="button" value="ì·¨ì†Œ" th:onclick="cancelReply([[${reply.id}]])"
                                   th:id="'cancelButton-' + ${reply.id}">
                        </div>
                    </form>
                    <!--ë‹µê¸€ ìˆ˜ì •  ë !!-->
                </li>
            </ul>
            <!-- ë‹µê¸€ ì‘ì„±ì‹œì‘  -->
            <input type="button" value="ë‹µê¸€ì“°ê¸°" th:onclick="toggleReply([[${comment.id}]])"
                   th:id="'replyButton-' + ${comment.id}">
        </div>
        <form th:action="@{|/reply/create/${comment.id}|}" th:object="${commentReplyForm}" method="post">
            <div th:id="'replyForm-' + ${comment.id}" style="display: none;" class="allReplyForm">
                <textarea class="form-control" placeholder="ë‹µê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”." id="floatingTextarea3" style="height: 100px"
                          name="content" th:value="${content}"></textarea>
                <input type="hidden" th:value="${comment.id}" name="commentId" th:id="CommentScriptId">
                <input type="submit" value="ë‹µê¸€ ì‘ì„±í•˜ê¸°" th:onclick="commentCreateRedirect()">
                <input type="button" value="ì·¨ì†Œ" th:onclick="createcancelReply([[${comment.id}]])">
            </div>
        </form>
        <!-- ë‹µê¸€ ì‘ì„±ì¢…ë£Œ  -->
    </li>
</ul>
<!--ëŒ“ê¸€ì‘ì„±ì‹œì‘-->
<form th:action="@{|/Comment/create/${id}|}" th:object="${commentcreateForm}" method="get">
    <div class="form-floating">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <input type="hidden" th:value="${article.id}" name="id" th:id="ActicleScriptId">
        <textarea class="form-control" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”." id="floatingTextarea2" style="height: 100px"
                  name="content" th:value="${content}" required></textarea>
        <input type="submit" value="ëŒ“ê¸€ ì‘ì„±í•˜ê¸°" onclick="submitCommentForm()">
    </div>
</form>
<!--ëŒ“ê¸€ ì‘ì„± ì¢…ë£Œ-->

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    function commentCreateRedirect(commentId) {
        // 'id' ë³€ìˆ˜ëŠ” í•´ë‹¹ ê°’ì„ ì‚¬ìš©í•˜ë„ë¡ ëŒ€ì²´í•´ì•¼ í•©ë‹ˆë‹¤.
        var id = document.getElementById("CommentScriptId").value;

        // 'content' ë³€ìˆ˜ëŠ” í•´ë‹¹ ê°’ì„ ì‚¬ìš©í•˜ë„ë¡ ëŒ€ì²´í•´ì•¼ í•©ë‹ˆë‹¤.
        var content = document.getElementById("floatingTextarea3").value;

        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ í›„ í¼ ì œì¶œ í•¨ìˆ˜ í˜¸ì¶œ
        checkLoginAndSubmit(id, content);
    }

    function checkLoginAndSubmit(id, content) {
        $.ajax({
            url: "/check-login-status",
            method: "GET",
            success: function(response) {
                if (response.loggedIn) {
                    // ë¡œê·¸ì¸ëœ ê²½ìš°, AJAXë¥¼ ì‚¬ìš©í•˜ì—¬ ëŒ“ê¸€ ì œì¶œ
                    $.ajax({
                        url: "/reply/create/" + id,
                        method: "POST",
                        data: { "content": content, "_csrf": "${_csrf.token}" },
                        success: function(commentResponse) {
                            // í•„ìš”í•œ ê²½ìš° ì„±ê³µ ì²˜ë¦¬ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
                        },
                        error: function() {
                            // í•„ìš”í•œ ê²½ìš° ì˜¤ë¥˜ ì²˜ë¦¬ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
                        }
                    });
                } else {
                    // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ê²½ìš°, ì•Œë¦¼ í‘œì‹œ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.");
                    window.location.href = "/member/login";
                }
            }
        });
    }
</script>
<script>
    function submitCommentForm(commentId) {
        // 'id' ë³€ìˆ˜ëŠ” í•´ë‹¹ ê°’ì„ ì‚¬ìš©í•˜ë„ë¡ ëŒ€ì²´í•´ì•¼ í•©ë‹ˆë‹¤.
        var id = document.getElementById("ActicleScriptId").value;

        // 'content' ë³€ìˆ˜ëŠ” í•´ë‹¹ ê°’ì„ ì‚¬ìš©í•˜ë„ë¡ ëŒ€ì²´í•´ì•¼ í•©ë‹ˆë‹¤.
        var content = document.getElementById("floatingTextarea2").value;

        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ í›„ í¼ ì œì¶œ í•¨ìˆ˜ í˜¸ì¶œ
        checkLoginAndSubmit(id, content);
    }

    function checkLoginAndSubmit(id, content) {
        $.ajax({
            url: "/check-login-status",
            method: "GET",
            success: function(response) {
                if (response.loggedIn) {
                    // ë¡œê·¸ì¸ëœ ê²½ìš°, AJAXë¥¼ ì‚¬ìš©í•˜ì—¬ ëŒ“ê¸€ ì œì¶œ
                    $.ajax({
                        url: "/Comment/create/" + id,
                        method: "POST",
                        data: { "content": content, "_csrf": "${_csrf.token}" },
                        success: function(commentResponse) {
                            // í•„ìš”í•œ ê²½ìš° ì„±ê³µ ì²˜ë¦¬ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
                        },
                        error: function() {
                            // í•„ìš”í•œ ê²½ìš° ì˜¤ë¥˜ ì²˜ë¦¬ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
                        }
                    });
                } else {
<<<<<<< HEAD:src/main/resources/templates/ArticleandBoard/articleDetail.html
                console.log(response);
=======
>>>>>>> 025012e728aab24fef5189286caa12b5282ecd21:src/main/resources/templates/articleDetail.html
                    // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ê²½ìš°, ì•Œë¦¼ í‘œì‹œ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤..");
                    window.location.href = "/member/login";
                }
            }
        });
    }
</script>
<script th:inline="javascript">

    let selectedReplyId = null;

    function toggleReply(commentId) {

        var replyForm = document.getElementById('replyForm-' + commentId);
        var replyFormButton = document.getElementById('replyButton-' + commentId);
        var allCommentModifyButton = document.getElementsByClassName('commentModifyClass');
        replyForm.style.display = replyForm.style.display === 'none' ? 'block' : 'none';

        console.log(selectedReplyId);
        console.log(allCommentModifyButton);
        if(selectedReplyId != null) {
            const target = document.getElementById('replyModifyButton-' + selectedReplyId);
            target.style.display = 'block';
        }
         if (selectedReplyId === null) {

            for (var i = 0; i <  allCommentModifyButton.length; i++) {
                allCommentModifyButton[i].style.display = 'block';
            }
        }

         var allReplyModifyForm = document.getElementsByClassName('allReplyModifyForm');
         var arrayFromCollection = Array.from(allReplyModifyForm);
         console.log(allReplyModifyForm);
        arrayFromCollection.forEach(function(allReplyModifyForm) {
            allReplyModifyForm.style.display = 'none';
        });

        var allCommentForm = document.getElementsByClassName('allComment');
        var arrayFromCollectionComment = Array.from(allCommentForm);
         console.log(allCommentForm);
        arrayFromCollectionComment.forEach(function(allCommentForm) {
            allCommentForm.style.display = 'none';
        });


        // ëª¨ë“  ë‹¤ë¥¸ ëŒ“ê¸€ì˜ replyFormì„ ìˆ¨ê¸°ê¸°
        var allReplyForms = document.querySelectorAll('[id^="replyForm-"]');
        allReplyForms.forEach(function(otherReplyForm) {
            if (otherReplyForm.id !== 'replyForm-' + commentId) {
                otherReplyForm.style.display = 'none';
            }
        });
        var isReplyButtonEnabled = true;


    }

    function submitReply(commentId) {
        // ì—¬ê¸°ì— ì‹¤ì œ ë‹µê¸€ì„ ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        var replyContent = document.getElementById('floatingTextarea3').value;
        console.log('Comment ID: ' + commentId + ', Reply Content: ' + replyContent);

        // ë‹µê¸€ ì‘ì„± í›„ í¼ ìˆ¨ê¸°ê¸°
        var replyForm = document.getElementById('replyForm-' + commentId);
        replyForm.style.display = 'none';
    }

    function createcancelReply(commentId) {
           console.log(commentId);
        // ì·¨ì†Œ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ë‹µê¸€ ì‘ì„± í¼ ìˆ¨ê¸°ê¸°
        var replyForm = document.getElementById('replyForm-' + commentId);
        replyForm.style.display = 'none';

    }

</script>
<script th:inline="javascript">


    function submitReply(replyId) {
        // ì—¬ê¸°ì— ì‹¤ì œ ìˆ˜ì •í•œ ë‹µê¸€ì„ ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        var replyContent = document.getElementById('floatingTextarea5').value;
        console.log('reply ID: ' + replyId + ', Reply Content: ' + replyContent);

        // ë‹µê¸€ ì‘ì„± í›„ í¼ ìˆ¨ê¸°ê¸°
        var replyModifyForm = document.getElementById('replyModifyForm-' + replyId);
        replyModifyForm.style.display = 'none';
         document.getElementById('replyButton-' + commentId).disabled = false;
    }

    function cancelReply(replyId) {
        // ì·¨ì†Œ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ìˆ˜ì • í¼ ìˆ¨ê¸°ê¸°
        var replyModifyForm = document.getElementById('replyModifyForm-' + replyId);
        replyModifyForm.style.display = 'none';

        // ìˆ˜ì • ë²„íŠ¼ ë‹¤ì‹œ í‘œì‹œ
        var replyModifyButton = document.getElementById('replyModifyButton-' + replyId);
        replyModifyButton.style.display = 'block';
    }


     function toggleReplyDivVisibility(replyId) {
        selectedReplyId = replyId;
        console.log(selectedReplyId);
        // ëª¨ë“  ë‹µê¸€ì— ëŒ€í•œ ìˆ˜ì • í¼ê³¼ ìˆ˜ì • ë²„íŠ¼ì„ ê°€ì ¸ì˜´
        var allReplyModifyForms = document.querySelectorAll('[id^=replyModifyForm-]');
        var allReplyModifyButtons = document.querySelectorAll('[id^=replyModifyButton-]');
        var allreplyReplyForm = document.getElementsByClassName('allReplyForm');
        var allCommentForm = document.getElementsByClassName('allComment');
        var allCommentModifyButton = document.getElementsByClassName('commentModifyClass');
          console.log(allCommentModifyButton);

              if (selectedReplyId !== null) {

            for (var i = 0; i < allCommentModifyButton.length; i++) {
                allCommentModifyButton[i].style.display = 'block';
            }
        }

        var arrayFromCollection = Array.from(allreplyReplyForm);
         console.log(arrayFromCollection);
        arrayFromCollection.forEach(function(allreplyReplyForm) {
            allreplyReplyForm.style.display = 'none';
        });

         var arrayCommentFromCollection = Array.from(allCommentForm);
         console.log(arrayCommentFromCollection);
        arrayCommentFromCollection.forEach(function(allCommentForm) {
            allCommentForm.style.display = 'none';
        });

        // ëª¨ë“  ë‹µê¸€ì— ëŒ€í•œ ìˆ˜ì • í¼ì„ ìˆ¨ê¹€
        allReplyModifyForms.forEach(function(form) {
            form.style.display = 'none';
        });

        // ëª¨ë“  ë‹µê¸€ì— ëŒ€í•œ ìˆ˜ì • ë²„íŠ¼ì„ í‘œì‹œ
        allReplyModifyButtons.forEach(function(button) {
            button.style.display = 'block';
        });

        // ì„ íƒí•œ ë‹µê¸€ì— ëŒ€í•œ ìˆ˜ì • í¼ê³¼ ìˆ˜ì • ë²„íŠ¼ì„ ê°€ì ¸ì˜´
        var replyModifyForm = document.getElementById('replyModifyForm-' + replyId);
        var replyModifyButton = document.getElementById('replyModifyButton-' + replyId);

        // ì„ íƒí•œ ë‹µê¸€ì— ëŒ€í•œ ìˆ˜ì • í¼ì„ í‘œì‹œ
        replyModifyForm.style.display = 'block';

        // ì„ íƒí•œ ë‹µê¸€ì— ëŒ€í•œ ìˆ˜ì • ë²„íŠ¼ì„ ìˆ¨ê¹€
        replyModifyButton.style.display = 'none';

    }
</script>
<script th:inline="javascript">
    var currentlyVisibleDivId = null;


    function toggleDivVisibility(commentId) {
          console.log(currentlyVisibleDivId);

        var contentDiv = document.getElementById("contentDiv-" + commentId);
        var commentButton = document.getElementById("commentButton-" + commentId);
        var cancelButton = document.getElementById("cancelButton-" + commentId);
        var allCommentModifyButtons = document.querySelectorAll('[id^=commentButton-]');
        var allreplyReplyForm = document.getElementsByClassName('allReplyForm');
        var allReplyModifyForm = document.getElementsByClassName('allReplyModifyForm');


        var arrayModifyFromCollection = Array.from(allReplyModifyForm);
         console.log(arrayModifyFromCollection);
        arrayModifyFromCollection.forEach(function(allReplyModifyForm) {
            allReplyModifyForm.style.display = 'none';
        });

        if(selectedReplyId != null) {
         const target = document.getElementById('replyModifyButton-' + selectedReplyId);
         target.style.display = 'block';
        }



        var arrayFromCollection = Array.from(allreplyReplyForm);
         console.log(arrayFromCollection);
        arrayFromCollection.forEach(function(allreplyReplyForm) {
            allreplyReplyForm.style.display = 'none';
        });


        if (currentlyVisibleDivId !== null) {
            hideDiv(currentlyVisibleDivId);
        }

        if (contentDiv.style.display === "none") {
            contentDiv.style.display = "block";
            commentButton.style.display = "none";
            currentlyVisibleDivId = commentId;
        } else {
            contentDiv.style.display = "none";
            commentButton.style.display = "block";
            currentlyVisibleDivId = null;
        }
    }

    function hideDiv(commentId) {
        var contentDiv = document.getElementById("contentDiv-" + commentId);
        var commentButton = document.getElementById("commentButton-" + commentId);

        contentDiv.style.display = "none";
        commentButton.style.display = "block";
    }
</script>
<script type='text/javascript'>
    const delete_elements = document.getElementsByClassName("delete");
    Array.from(delete_elements).forEach(function(element) {
        element.addEventListener('click', function() {
            if(confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                location.href = this.dataset.uri;
            };
        });
    });

      const recommend_elements = document.getElementsByClassName("recommend");

Array.from(recommend_elements).forEach(function (element) {
    element.addEventListener('click', function (event) {
        // í˜„ì¬ ì¶”ì²œ ìƒíƒœ í™•ì¸
        const isRecommended = element.getAttribute('data-recommended') === 'true';

        // ì„œë²„ì™€ í†µì‹ í•˜ì—¬ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        checkLoginStatus().then(response => {
            if (!response.loggedIn) {
                // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ê²½ìš°, ì•Œë¦¼ í‘œì‹œ í›„ ì´ë²¤íŠ¸ ê¸°ë³¸ ë™ì‘(ë§í¬ ì´ë™) ìˆ˜í–‰í•˜ì§€ ì•ŠìŒ
                alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.");
                window.location.href = "/member/login";
                event.preventDefault();
            } else {
                // ë¡œê·¸ì¸ëœ ê²½ìš°, ì¶”ì²œ í† ê¸€ ë¡œì§ ìˆ˜í–‰
                location.href = this.dataset.uri;
                element.setAttribute('data-recommended', isRecommended ? 'false' : 'true');
                // ì¶”ì²œ ìƒíƒœì— ë”°ë¥¸ UI ì—…ë°ì´íŠ¸ ë“±ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            }
        }).catch(error => {
            console.error("Login status check failed:", error);
        });
    });
});

// ì„œë²„ì™€ í†µì‹ í•˜ì—¬ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
function checkLoginStatus() {
    return fetch("/check-login-status")
        .then(response => response.json())
        .catch(error => {
            console.error("Login status check failed:", error);
        });
}
</script>
</body>
</html>